<!DOCTYPE html>
<html lang="en">
<head>
<script>
// Force HTTPS in production while allowing local development.
if (location.protocol === "http:" && location.hostname !== "localhost" && location.hostname !== "127.0.0.1") {
  location.replace("https://" + location.host + location.pathname + location.search + location.hash);
}
</script>
<script src="/consent.js"></script>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KLC65F5M');</script>
<!-- End Google Tag Manager -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://pagead2.googlesyndication.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https://translate.googleapis.com https://www.googletagmanager.com https://www.google-analytics.com https://region1.google-analytics.com https://googleads.g.doubleclick.net https://pagead2.googlesyndication.com; frame-src https:; object-src 'none'; base-uri 'self'; form-action 'self' https://formspree.io; frame-ancestors 'none'; upgrade-insecure-requests">
<meta name="referrer" content="strict-origin-when-cross-origin">
<meta name="google-adsense-account" content="ca-pub-6632867015737384">
<link rel="preconnect" href="https://www.googletagmanager.com">
<link rel="dns-prefetch" href="https://www.googletagmanager.com">
<link rel="preconnect" href="https://pagead2.googlesyndication.com">
<link rel="dns-prefetch" href="https://pagead2.googlesyndication.com">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="dns-prefetch" href="https://www.google-analytics.com">
<title>Haggly â€” Negotiate in Any Language</title>
<meta name="description" content="Free marketplace negotiation translator. Bargain on Facebook Marketplace, Craigslist, and more in any language. Instant phrase translation for buyers and sellers.">
<link rel="canonical" href="https://haggly.io/">
<meta property="og:site_name" content="Haggly">
<meta property="og:title" content="Haggly â€” Negotiate in Any Language">
<meta property="og:description" content="Free marketplace negotiation translator. Bargain on Facebook Marketplace, Craigslist, and more in any language. Instant phrase translation for buyers and sellers.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://haggly.io/">
<meta property="og:image" content="https://haggly.io/social-card.svg">
<meta property="og:image:type" content="image/svg+xml">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Haggly â€” Negotiate in Any Language">
<meta name="twitter:description" content="Free marketplace negotiation translator. Bargain on Facebook Marketplace, Craigslist, and more in any language. Instant phrase translation for buyers and sellers.">
<meta name="twitter:image" content="https://haggly.io/social-card.svg">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Haggly",
  "url": "https://haggly.io/",
  "logo": "https://haggly.io/icon.svg"
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Haggly",
  "url": "https://haggly.io/"
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "Is Haggly free to use?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes. Haggly is free to use for translating negotiation phrases."
      }
    },
    {
      "@type": "Question",
      "name": "Which marketplaces does Haggly support?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Haggly is designed for common local marketplaces such as Facebook Marketplace and Craigslist, plus in-person market negotiation."
      }
    },
    {
      "@type": "Question",
      "name": "Does Haggly store my custom phrases?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "No. Custom translations run in your browser and are not saved by Haggly."
      }
    }
  ]
}
</script>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#5865F2">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6632867015737384" crossorigin="anonymous"></script>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¤</text></svg>">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --primary: #5865F2;
    --primary-dark: #4752C4;
    --bg: #FAFAFA;
    --card: #FFFFFF;
    --text: #1a1a1a;
    --muted: #666;
    --border: #e0e0e0;
    --green: #00C853;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    min-height: 100vh;
  }

  /* Header */
  .header {
    background: var(--primary);
    color: white;
    text-align: center;
    padding: 40px 20px 30px;
  }
  .header h1 {
    font-size: 42px;
    font-weight: 800;
    letter-spacing: -1px;
  }
  .header p {
    font-size: 20px;
    opacity: 0.9;
    margin-top: 8px;
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
  }

  /* Main Container */
  .container {
    max-width: 700px;
    margin: 0 auto;
    padding: 20px;
  }

  /* Language Selector */
  .lang-section {
    background: var(--card);
    border-radius: 16px;
    padding: 24px;
    margin: 20px 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  }
  .lang-row {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
  }
  .lang-label {
    font-size: 14px;
    font-weight: 600;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    min-width: 80px;
  }
  select {
    flex: 1;
    padding: 14px 16px;
    font-size: 18px;
    border: 2px solid var(--border);
    border-radius: 12px;
    background: white;
    color: var(--text);
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 16px center;
  }
  select:focus { border-color: var(--primary); outline: none; }

  .swap-btn {
    background: var(--primary);
    color: white;
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    transition: transform 0.2s;
  }
  .swap-btn:hover { transform: rotate(180deg); }

  /* Role Selector */
  .role-row {
    display: flex;
    gap: 10px;
    margin: 20px 0;
  }
  .role-btn {
    flex: 1;
    padding: 14px;
    font-size: 18px;
    font-weight: 600;
    border: 2px solid var(--border);
    border-radius: 12px;
    background: white;
    cursor: pointer;
    text-align: center;
    transition: all 0.2s;
  }
  .role-btn.active {
    border-color: var(--primary);
    background: #EEF0FE;
    color: var(--primary);
  }
  .role-btn:hover { border-color: var(--primary); }

  .copied-toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: #333;
    color: white;
    padding: 12px 24px;
    border-radius: 30px;
    font-size: 16px;
    font-weight: 600;
    transition: transform 0.3s ease;
    z-index: 100;
  }
  .copied-toast.show { transform: translateX(-50%) translateY(0); }

  /* Custom phrase input */
  .custom-input {
    background: var(--card);
    border-radius: 16px;
    padding: 20px;
    margin: 20px 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  }
  .custom-input textarea {
    width: 100%;
    padding: 14px;
    font-size: 18px;
    border: 2px solid var(--border);
    border-radius: 12px;
    resize: vertical;
    min-height: 60px;
    font-family: inherit;
  }
  .custom-input textarea:focus { border-color: var(--primary); outline: none; }
  .translate-btn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 14px 28px;
    font-size: 18px;
    font-weight: 600;
    border-radius: 12px;
    cursor: pointer;
    margin-top: 12px;
    width: 100%;
    transition: background 0.2s;
  }
  .translate-btn:hover { background: var(--primary-dark); }
  .custom-result {
    margin-top: 16px;
    padding: 16px;
    background: #EEF0FE;
    border-radius: 12px;
    font-size: 20px;
    font-weight: 600;
    display: none;
    cursor: pointer;
  }

  /* Nav */
  nav { background: var(--primary); padding: 14px 20px; display: flex; align-items: center; flex-wrap: wrap; gap: 8px; }
  nav a { color: white; text-decoration: none; font-weight: 600; font-size: 15px; padding: 6px 12px; border-radius: 8px; transition: background 0.2s; }
  nav a:hover { background: rgba(255,255,255,0.2); }
  nav .brand { font-size: 20px; font-weight: 800; margin-right: 0; }

  /* Footer */
  .footer {
    text-align: center;
    padding: 30px 20px;
    color: var(--muted);
    font-size: 14px;
    border-top: 1px solid var(--border);
    margin-top: 20px;
  }
  .footer a { color: var(--primary); text-decoration: none; }
  .footer-links { margin-bottom: 12px; }
  .footer-links a { margin: 0 10px; }

  /* TTS button */
  .tts-btn {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 18px;
    padding: 2px 6px;
    margin-left: 6px;
    border-radius: 6px;
    vertical-align: middle;
    opacity: 0.6;
    transition: opacity 0.2s;
  }
  .tts-btn:hover { opacity: 1; background: #EEF0FE; }
  .handoff-btn {
    background: #EEF0FE;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 4px 8px;
    font-size: 12px;
    font-weight: 700;
    cursor: pointer;
    color: var(--primary);
  }
  .handoff-btn:hover { background: #E3E7FF; }

  .recent-section {
    background: var(--card);
    border-radius: 16px;
    padding: 16px;
    margin: 20px 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    content-visibility: auto;
    contain-intrinsic-size: 300px;
  }
  .recent-section h2 {
    font-size: 16px;
    color: var(--primary);
    margin-bottom: 10px;
  }
  .recent-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .recent-item {
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 10px 12px;
    background: #fff;
    cursor: pointer;
  }
  .recent-text {
    font-size: 15px;
    font-weight: 600;
  }
  .recent-meta {
    color: var(--muted);
    font-size: 12px;
    margin-top: 2px;
  }
  .recent-actions {
    display: flex;
    gap: 6px;
    margin-top: 6px;
  }

  /* Negotiation Generator */
  .nego-section {
    background: var(--card);
    border-radius: 16px;
    padding: 24px;
    margin: 20px 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  }
  .nego-section h2 {
    font-size: 20px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 16px;
    text-align: center;
  }
  .nego-inputs {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 16px;
  }
  .nego-field label {
    display: block;
    font-size: 13px;
    font-weight: 600;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
  }
  .nego-field input {
    width: 100%;
    padding: 12px 14px;
    font-size: 18px;
    border: 2px solid var(--border);
    border-radius: 12px;
    background: white;
    color: var(--text);
    font-family: inherit;
  }
  .nego-field input:focus { border-color: var(--primary); outline: none; }
  .currency-hint {
    margin: 6px 0 12px;
    font-size: 13px;
    color: var(--muted);
    text-align: center;
  }
  .nego-generate-btn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 14px 28px;
    font-size: 18px;
    font-weight: 600;
    border-radius: 12px;
    cursor: pointer;
    width: 100%;
    transition: background 0.2s;
  }
  .nego-generate-btn:hover { background: var(--primary-dark); }
  .nego-generate-btn:disabled { opacity: 0.6; cursor: not-allowed; }
  .nego-results {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 16px;
  }
  .nego-card {
    background: #F8F8FF;
    border-radius: 12px;
    padding: 16px 20px;
    border-left: 4px solid var(--primary);
  }
  .nego-card.friendly { border-left-color: #00C853; }
  .nego-card.savvy { border-left-color: #FF9800; }
  .nego-card.walkaway { border-left-color: #F44336; }
  .nego-card-header {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 8px;
  }
  .nego-card .phrase-original {
    font-size: 13px;
    color: var(--muted);
    margin-bottom: 4px;
  }
  .nego-card .nego-translated {
    font-size: 18px;
    font-weight: 600;
    color: var(--text);
    display: inline;
  }
  .nego-card-actions {
    margin-top: 8px;
    display: flex;
    gap: 8px;
  }
  .nego-action-btn {
    background: none;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 4px 10px;
    font-size: 15px;
    cursor: pointer;
    transition: background 0.2s;
  }
  .nego-action-btn:hover { background: #EEF0FE; }

  .faq-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  .faq-item h3 {
    font-size: 18px;
    margin-bottom: 6px;
  }
  .faq-item p {
    color: var(--muted);
  }
  .faq-section {
    content-visibility: auto;
    contain-intrinsic-size: 420px;
  }

  @media (max-width: 600px) {
    nav { justify-content: center; }
    nav .brand { width: 100%; text-align: center; }
  }
</style>
</head>
<body>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KLC65F5M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<nav>
  <a href="/" class="brand">ğŸ¤ Haggly</a>
  <a href="/" data-i18n="nav_home">Home</a>
  <a href="/phrases.html" data-i18n="nav_phrases">Popular Phrases</a>
  <a href="/guide.html" data-i18n="nav_guide">City Guides</a>
  <a href="/about.html" data-i18n="nav_about">About</a>
  <a href="/privacy.html" data-i18n="nav_privacy">Privacy</a>
  <a href="/terms.html" data-i18n="nav_terms">Terms</a>
  <a href="/contact.html" data-i18n="nav_contact">Contact</a>
</nav>

<div class="header">
  <h1>ğŸ¤ Haggly</h1>
  <p data-i18n="header_tagline">Negotiate in any language. Tap a phrase, copy it, close the deal.</p>
</div>

<div class="container">

  <!-- Language Selection -->
  <div class="lang-section">
    <div class="lang-row">
      <span class="lang-label" data-i18n="label_i_speak">I speak</span>
      <select id="fromLang">
        <option value="en">ğŸ‡ºğŸ‡¸ English</option>
        <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
        <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
        <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
        <option value="hi">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
        <option value="pt">ğŸ‡§ğŸ‡· PortuguÃªs</option>
        <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
        <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
        <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
        <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
        <option value="vi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</option>
        <option value="tl">ğŸ‡µğŸ‡­ Tagalog</option>
        <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
        <option value="pl">ğŸ‡µğŸ‡± Polski</option>
        <option value="uk">ğŸ‡ºğŸ‡¦ Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°</option>
        <option value="sw">ğŸ‡°ğŸ‡ª Kiswahili</option>
        <option value="ha">ğŸ‡³ğŸ‡¬ Hausa</option>
        <option value="am">ğŸ‡ªğŸ‡¹ áŠ áˆ›áˆ­áŠ›</option>
        <option value="ht">ğŸ‡­ğŸ‡¹ KreyÃ²l Ayisyen</option>
        <option value="th">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</option>
        <option value="tr">ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</option>
        <option value="id">ğŸ‡®ğŸ‡© Bahasa Indonesia</option>
      </select>
    </div>

    <button class="swap-btn" data-i18n-title="swap_title" title="Swap languages">â‡…</button>

    <div class="lang-row" style="margin-top:12px">
      <span class="lang-label" data-i18n="label_they_speak">They speak</span>
      <select id="toLang">
        <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
        <option value="en">ğŸ‡ºğŸ‡¸ English</option>
        <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
        <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
        <option value="hi">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
        <option value="pt">ğŸ‡§ğŸ‡· PortuguÃªs</option>
        <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
        <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
        <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
        <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
        <option value="vi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</option>
        <option value="tl">ğŸ‡µğŸ‡­ Tagalog</option>
        <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
        <option value="pl">ğŸ‡µğŸ‡± Polski</option>
        <option value="uk">ğŸ‡ºğŸ‡¦ Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°</option>
        <option value="sw">ğŸ‡°ğŸ‡ª Kiswahili</option>
        <option value="ha">ğŸ‡³ğŸ‡¬ Hausa</option>
        <option value="am">ğŸ‡ªğŸ‡¹ áŠ áˆ›áˆ­áŠ›</option>
        <option value="ht">ğŸ‡­ğŸ‡¹ KreyÃ²l Ayisyen</option>
        <option value="th">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</option>
        <option value="tr">ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</option>
        <option value="id">ğŸ‡®ğŸ‡© Bahasa Indonesia</option>
      </select>
    </div>
  </div>

  <!-- Role -->
  <div class="role-row">
    <button class="role-btn active" data-role="buyer" data-i18n="btn_buying">ğŸ›’ I'm Buying</button>
    <button class="role-btn" data-role="seller" data-i18n="btn_selling">ğŸ’° I'm Selling</button>
  </div>

  <div class="recent-section" id="recentPhrasesSection" hidden>
    <h2>ğŸ•˜ Recent Phrases</h2>
    <div class="recent-list" id="recentPhrasesList"></div>
  </div>

  <!-- Negotiation Generator -->
  <div class="nego-section">
    <h2 data-i18n="negotiation_tool">ğŸ’¬ Negotiation Generator</h2>
    <div class="nego-inputs">
      <div class="nego-field">
        <label data-i18n="nego_asking_price">Asking Price</label>
        <input type="number" id="negoAskingPrice" value="100" placeholder="100" min="0" step="any">
      </div>
      <div class="nego-field">
        <label data-i18n="nego_target_price">Your Target Price</label>
        <input type="number" id="negoTargetPrice" value="75" placeholder="75" min="0" step="any">
      </div>
      <div class="nego-field">
        <label data-i18n="nego_walkaway_price">Your Walk-Away Price</label>
        <input type="number" id="negoWalkawayPrice" value="85" placeholder="85" min="0" step="any">
      </div>
    </div>
    <div class="currency-hint" id="currencyHint">Defaults align to about $100 USD in local currency.</div>
    <button class="nego-generate-btn" type="button" data-i18n="nego_generate">Generate Phrases âœ¨</button>
    <div class="nego-results" id="negoResults"></div>
  </div>

  <!-- Custom Phrase -->
  <div class="custom-input">
    <textarea id="customPhrase" data-i18n="custom_placeholder" placeholder="Type your own phrase to translate..."></textarea>
    <button class="translate-btn" type="button" data-i18n="btn_translate">Translate â†’</button>
    <div class="custom-result" id="customResult"></div>
  </div>

  <!-- Phrases CTA -->
  <div class="nego-section" style="text-align:center">
    <a href="/phrases.html" style="color:var(--primary); font-weight:700; font-size:20px; text-decoration:none;">ğŸ’¬ Browse 50+ Ready-Made Phrases â†’</a>
    <p style="color:var(--muted); font-size:15px; margin-top:8px;">Pre-translated negotiation phrases for buying and selling</p>
  </div>

  <div class="nego-section faq-section">
    <h2>FAQ</h2>
    <div class="faq-list">
      <div class="faq-item">
        <h3>Is Haggly free to use?</h3>
        <p>Yes. Haggly is free to use for translating negotiation phrases.</p>
      </div>
      <div class="faq-item">
        <h3>Which marketplaces does Haggly support?</h3>
        <p>Haggly is designed for common local marketplaces such as Facebook Marketplace and Craigslist, plus in-person market negotiation.</p>
      </div>
      <div class="faq-item">
        <h3>Does Haggly store my custom phrases?</h3>
        <p>No. Custom translations run in your browser and are not saved by Haggly.</p>
      </div>
    </div>
  </div>

  <div class="footer">
    <div class="footer-links">
      <a href="/about.html" data-i18n="footer_about">About</a>
      <a href="/privacy.html" data-i18n="footer_privacy">Privacy Policy</a>
      <a href="/terms.html" data-i18n="footer_terms">Terms of Service</a>
      <a href="/contact.html" data-i18n="footer_contact">Contact</a>
    </div>
    <p data-i18n="footer_copyright">Â© 2026 Haggly. Built with â¤ï¸ for the global marketplace.</p>
  </div>
</div>

<div class="copied-toast" id="toast" data-i18n="toast_copied">âœ… Copied! Paste it in your chat</div>

<script>
let currentRole = 'buyer';
const FROM_LANG_STORAGE_KEY = 'haggly-from-lang';
const RECENT_PHRASES_STORAGE_KEY = 'haggly-recent-phrases-v1';
const MAX_RECENT_PHRASES = 5;
const PAGE_ID = 'home';
let userChangedToLang = false;
let hasManualPriceInput = false;

const USD_DEFAULTS = { asking: 100, target: 75, walkaway: 85 };
const LANG_CURRENCY = {
  en: 'USD', es: 'MXN', zh: 'CNY', ar: 'SAR', hi: 'INR', pt: 'BRL', fr: 'EUR', de: 'EUR',
  ja: 'JPY', ko: 'KRW', vi: 'VND', tl: 'PHP', ru: 'RUB', pl: 'PLN', uk: 'UAH', sw: 'KES',
  ha: 'NGN', am: 'ETB', ht: 'HTG', th: 'THB', tr: 'TRY', id: 'IDR'
};
const CURRENCY_PER_USD = {
  // Snapshot from ExchangeRate-API (USD base), retrieved February 20, 2026.
  USD: 1, MXN: 17.261161, CNY: 6.916257, SAR: 3.75, INR: 86.665036, BRL: 5.710294,
  EUR: 0.956361, JPY: 149.772024, KRW: 1437.330862, VND: 25549.122968, PHP: 57.912161,
  RUB: 88.027629, PLN: 3.747402, UAH: 41.556944, KES: 129.171177, NGN: 1520.333567,
  ETB: 130.713301, HTG: 130.32974, THB: 33.537272, TRY: 36.485353, IDR: 16370.17084
};

function getCurrencyForLanguage(lang) {
  return LANG_CURRENCY[lang] || 'USD';
}

function roundPrice(value, currency) {
  if (currency === 'JPY' || currency === 'KRW' || currency === 'VND' || currency === 'IDR') {
    return Math.max(1, Math.round(value / 10) * 10);
  }
  if (value >= 100) return Math.max(1, Math.round(value));
  if (value >= 10) return Math.max(1, Math.round(value * 2) / 2);
  return Math.max(0.5, Math.round(value * 100) / 100);
}

function formatMoney(value, currency) {
  try {
    return new Intl.NumberFormat(undefined, {
      style: 'currency',
      currency: currency,
      maximumFractionDigits: 2
    }).format(value);
  } catch (e) {
    return `${value} ${currency}`;
  }
}

function getLocalizedDefaultsForLanguage(lang) {
  const currency = getCurrencyForLanguage(lang);
  const rate = CURRENCY_PER_USD[currency] || 1;
  const asking = roundPrice(USD_DEFAULTS.asking * rate, currency);
  const target = roundPrice(USD_DEFAULTS.target * rate, currency);
  const walkaway = roundPrice(USD_DEFAULTS.walkaway * rate, currency);
  return { currency, asking, target, walkaway };
}

function updateCurrencyHint(defaults) {
  const hint = document.getElementById('currencyHint');
  if (!hint) return;
  hint.textContent = `Defaults: ${formatMoney(defaults.asking, defaults.currency)} / ${formatMoney(defaults.target, defaults.currency)} / ${formatMoney(defaults.walkaway, defaults.currency)} (about $100 / $75 / $85 USD).`;
}

function applyNegotiationDefaults(force) {
  const to = document.getElementById('toLang');
  const askingInput = document.getElementById('negoAskingPrice');
  const targetInput = document.getElementById('negoTargetPrice');
  const walkawayInput = document.getElementById('negoWalkawayPrice');
  if (!to || !askingInput || !targetInput || !walkawayInput) return;

  const defaults = getLocalizedDefaultsForLanguage(to.value);
  updateCurrencyHint(defaults);

  if (!force && hasManualPriceInput) return;
  askingInput.value = defaults.asking;
  targetInput.value = defaults.target;
  walkawayInput.value = defaults.walkaway;
}

function getSupportedLang(code) {
  const normalized = (code || '').toLowerCase().split('-')[0];
  return document.querySelector(`#fromLang option[value="${normalized}"]`) ? normalized : null;
}

function getPreferredLang() {
  if (window.hagglyI18n && typeof window.hagglyI18n.getUILang === 'function') {
    const uiLang = getSupportedLang(window.hagglyI18n.getUILang());
    if (uiLang) return uiLang;
  }
  return getSupportedLang(navigator.language || '') || 'en';
}

function initializeLanguageSelectors() {
  const from = document.getElementById('fromLang');
  const to = document.getElementById('toLang');
  if (!from || !to) return;

  const savedFrom = getSupportedLang(localStorage.getItem(FROM_LANG_STORAGE_KEY));
  const preferred = savedFrom || getPreferredLang();

  from.value = preferred;
  to.value = preferred;
  userChangedToLang = false;
  applyNegotiationDefaults(true);
}

function handleFromLangChange() {
  const from = document.getElementById('fromLang');
  const to = document.getElementById('toLang');
  localStorage.setItem(FROM_LANG_STORAGE_KEY, from.value);
  if (!userChangedToLang && to) {
    to.value = from.value;
  }
  applyNegotiationDefaults(false);
  trackEvent('language_changed', { context: 'from_selector' });
}

function handleToLangChange() {
  userChangedToLang = true;
  applyNegotiationDefaults(false);
  trackEvent('language_changed', { context: 'to_selector' });
}

function getBaseEventParams(extraParams) {
  const from = document.getElementById('fromLang');
  const to = document.getElementById('toLang');
  return Object.assign(
    {
      page: PAGE_ID,
      role: currentRole,
      from_lang: from ? from.value : null,
      to_lang: to ? to.value : null
    },
    extraParams || {}
  );
}

function loadRecentPhrases() {
  try {
    const raw = localStorage.getItem(RECENT_PHRASES_STORAGE_KEY);
    const parsed = raw ? JSON.parse(raw) : [];
    return Array.isArray(parsed) ? parsed : [];
  } catch (e) {
    return [];
  }
}

function saveRecentPhrases(items) {
  localStorage.setItem(RECENT_PHRASES_STORAGE_KEY, JSON.stringify(items.slice(0, MAX_RECENT_PHRASES)));
}

function renderRecentPhrases() {
  const section = document.getElementById('recentPhrasesSection');
  const listEl = document.getElementById('recentPhrasesList');
  if (!section || !listEl) return;

  const items = loadRecentPhrases();
  listEl.replaceChildren();
  section.hidden = items.length === 0;
  if (items.length === 0) return;

  const fragment = document.createDocumentFragment();
  for (const item of items) {
    const card = document.createElement('div');
    card.className = 'recent-item';
    card.setAttribute('role', 'button');
    card.setAttribute('tabindex', '0');
    card.dataset.copy = item.text;
    card.dataset.context = 'recent_phrase';

    const text = document.createElement('div');
    text.className = 'recent-text';
    text.textContent = item.text;

    const meta = document.createElement('div');
    meta.className = 'recent-meta';
    meta.textContent = `${(item.from_lang || '').toUpperCase()} â†’ ${(item.to_lang || '').toUpperCase()} â€¢ ${item.source || 'saved'}`;

    const actions = document.createElement('div');
    actions.className = 'recent-actions';

    const shareBtn = document.createElement('button');
    shareBtn.type = 'button';
    shareBtn.className = 'handoff-btn';
    shareBtn.textContent = 'Share';
    shareBtn.dataset.share = item.text;
    shareBtn.dataset.shareContext = 'recent_phrase';

    const smsBtn = document.createElement('button');
    smsBtn.type = 'button';
    smsBtn.className = 'handoff-btn';
    smsBtn.textContent = 'SMS';
    smsBtn.dataset.sms = item.text;
    smsBtn.dataset.shareContext = 'recent_phrase';

    const waBtn = document.createElement('button');
    waBtn.type = 'button';
    waBtn.className = 'handoff-btn';
    waBtn.textContent = 'WA';
    waBtn.dataset.whatsapp = item.text;
    waBtn.dataset.shareContext = 'recent_phrase';

    actions.appendChild(shareBtn);
    actions.appendChild(smsBtn);
    actions.appendChild(waBtn);
    card.appendChild(text);
    card.appendChild(meta);
    card.appendChild(actions);
    fragment.appendChild(card);
  }
  listEl.appendChild(fragment);
}

function addRecentPhrase(text, source, extra) {
  if (!text) return;
  const trimmed = text.trim();
  if (!trimmed) return;
  const details = getBaseEventParams(extra);
  const items = loadRecentPhrases().filter((item) => !(item.text === trimmed && item.to_lang === details.to_lang));
  items.unshift({
    text: trimmed,
    source: source || 'unknown',
    page: details.page,
    role: details.role,
    from_lang: details.from_lang,
    to_lang: details.to_lang,
    ts: Date.now()
  });
  saveRecentPhrases(items);
  renderRecentPhrases();
}

function openSMS(text, extra) {
  const body = encodeURIComponent(text);
  const link = `sms:?&body=${body}`;
  window.location.href = link;
  trackEvent('handoff_sms_click', getBaseEventParams(Object.assign({ context: 'sms' }, extra || {})));
}

function openWhatsApp(text, extra) {
  const link = `https://wa.me/?text=${encodeURIComponent(text)}`;
  window.open(link, '_blank', 'noopener,noreferrer');
  trackEvent('handoff_whatsapp_click', getBaseEventParams(Object.assign({ context: 'whatsapp' }, extra || {})));
}

function setRole(role) {
  currentRole = role;
  document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
  document.querySelector(`[data-role="${role}"]`).classList.add('active');
}

function swapLangs() {
  const from = document.getElementById('fromLang');
  const to = document.getElementById('toLang');
  const tmp = from.value;
  from.value = to.value;
  to.value = tmp;
  userChangedToLang = true;
  localStorage.setItem(FROM_LANG_STORAGE_KEY, from.value);
  applyNegotiationDefaults(false);
  trackEvent('language_changed', { context: 'swap' });
}

function copyText(text, context) {
  navigator.clipboard.writeText(text).then(() => {
    const details = getBaseEventParams({ context: context || 'copy' });
    trackEvent('copy_phrase', details);
    if ((context || '').indexOf('recent_phrase') === 0) {
      trackEvent('recent_phrase_used', { context: context });
    }
    addRecentPhrase(text, 'copy', details);
    showToast(window.hagglyI18n ? window.hagglyI18n.t('toast_copied') : 'âœ… Copied! Paste it in your chat');
  });
}

function trackEvent(eventName, params) {
  try {
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push(Object.assign({ event: eventName }, getBaseEventParams(params)));
  } catch (e) {}
}

function showToast(message) {
  const toast = document.getElementById('toast');
  if (!toast) return;
  toast.textContent = message;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 2000);
}

async function shareText(text, context, extraParams) {
  const details = getBaseEventParams(Object.assign({ context: context }, extraParams || {}));
  const t = window.hagglyI18n ? window.hagglyI18n.t : function(k, fb) { return fb || k; };
  if (navigator.share) {
    try {
      trackEvent('share_opened', details);
      await navigator.share({ text: text });
      trackEvent('share_success', details);
      if (context === 'recent_phrase') {
        trackEvent('recent_phrase_shared', { context: context });
      }
      addRecentPhrase(text, 'share', details);
      showToast(t('toast_shared', 'âœ… Shared'));
      return;
    } catch (e) {}
  }
  trackEvent('share_fallback_copy', Object.assign({ reason: 'unsupported_or_error' }, details));
  copyText(text, `${context || 'unknown'}_fallback`);
}

async function translateCustom() {
  const text = document.getElementById('customPhrase').value.trim();
  if (!text) return;
  const result = document.getElementById('customResult');
  const sl = document.getElementById('fromLang').value;
  const tl = document.getElementById('toLang').value;
  result.style.display = 'block';
  result.replaceChildren();
  result.textContent = 'â³ Translating...';
  try {
    trackEvent('custom_translate_started', { from_lang: sl, to_lang: tl });
    const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${encodeURIComponent(sl)}&tl=${encodeURIComponent(tl)}&dt=t&q=${encodeURIComponent(text)}`;
    const res = await fetch(url);
    if (!res.ok) throw new Error('Translation failed');
    const data = await res.json();
    const translated = data[0].map(s => s[0]).join('');
    result.replaceChildren();
    const textNode = document.createElement('span');
    textNode.className = 'phrase-translated custom-copy-target';
    textNode.style.cursor = 'pointer';
    textNode.setAttribute('role', 'button');
    textNode.setAttribute('tabindex', '0');
    textNode.dataset.copy = translated;
    textNode.dataset.context = 'custom_translation';
    textNode.textContent = translated;

    const speakBtn = document.createElement('button');
    speakBtn.className = 'tts-btn';
    speakBtn.type = 'button';
    speakBtn.dataset.speak = translated;
    speakBtn.dataset.lang = tl;
    speakBtn.title = 'Listen';
    speakBtn.textContent = 'ğŸ”Š';

    const shareBtn = document.createElement('button');
    shareBtn.className = 'tts-btn';
    shareBtn.type = 'button';
    shareBtn.dataset.share = translated;
    shareBtn.dataset.shareContext = 'custom_translation';
    shareBtn.title = window.hagglyI18n ? window.hagglyI18n.t('btn_share', 'Share') : 'Share';
    shareBtn.textContent = 'â†—';

    const smsBtn = document.createElement('button');
    smsBtn.className = 'handoff-btn';
    smsBtn.type = 'button';
    smsBtn.dataset.sms = translated;
    smsBtn.dataset.shareContext = 'custom_translation';
    smsBtn.textContent = 'SMS';

    const waBtn = document.createElement('button');
    waBtn.className = 'handoff-btn';
    waBtn.type = 'button';
    waBtn.dataset.whatsapp = translated;
    waBtn.dataset.shareContext = 'custom_translation';
    waBtn.textContent = 'WA';

    result.appendChild(textNode);
    result.appendChild(speakBtn);
    result.appendChild(shareBtn);
    result.appendChild(smsBtn);
    result.appendChild(waBtn);
    trackEvent('custom_translate_success', { from_lang: sl, to_lang: tl });
  } catch (e) {
    result.replaceChildren();
    result.textContent = 'âŒ Translation error. Please try again.';
    trackEvent('custom_translate_error', { from_lang: sl, to_lang: tl });
  }
}

function speakText(text, lang) {
  if ('speechSynthesis' in window) {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = lang;
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
    trackEvent('tts_played', { context: 'speak_action' });
  }
}

// Negotiation Generator
function getNegoTemplates(role, asking, target, walkaway) {
  if (role === 'buyer') {
    return [
      { tone: 'friendly', emoji: 'ğŸ¤', label: 'nego_tone_friendly', labelFallback: 'Friendly', css: 'friendly',
        text: `That's a nice item. Would you consider ${target}? I really like it and I'm ready to buy today.` },
      { tone: 'savvy', emoji: 'ğŸ˜', label: 'nego_tone_savvy', labelFallback: 'Savvy', css: 'savvy',
        text: `I know the fair price is around ${target}. I'll pay that right now, cash in hand.` },
      { tone: 'walkaway', emoji: 'ğŸš¶', label: 'nego_tone_walkaway', labelFallback: 'Walk-Away', css: 'walkaway',
        text: `Thank you, but ${asking} is too much for me. I can only do ${walkaway}. If not, no problem. Good luck with the sale.` }
    ];
  } else {
    return [
      { tone: 'friendly', emoji: 'ğŸ¤', label: 'nego_tone_friendly', labelFallback: 'Friendly', css: 'friendly',
        text: `Thanks for your interest! I'm asking ${asking}, but I could do ${target} if you can pick it up today.` },
      { tone: 'savvy', emoji: 'ğŸ˜', label: 'nego_tone_savvy', labelFallback: 'Savvy', css: 'savvy',
        text: `This is a great deal at ${asking}. I already have other people interested, but I can do ${target} if you come today.` },
      { tone: 'walkaway', emoji: 'ğŸš¶', label: 'nego_tone_walkaway', labelFallback: 'Walk-Away', css: 'walkaway',
        text: `The lowest I can go is ${walkaway}. That's firm. If that doesn't work for you, no worries.` }
    ];
  }
}

async function translateText(text, tl) {
  const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=${encodeURIComponent(tl)}&dt=t&q=${encodeURIComponent(text)}`;
  const res = await fetch(url);
  if (!res.ok) throw new Error('Translation failed');
  const data = await res.json();
  return data[0].map(s => s[0]).join('');
}

async function generateNegoPhrases() {
  const asking = document.getElementById('negoAskingPrice').value.trim();
  const target = document.getElementById('negoTargetPrice').value.trim();
  const walkaway = document.getElementById('negoWalkawayPrice').value.trim();
  if (!asking || !target || !walkaway) { alert('Please fill in all three prices.'); return; }

  const tl = document.getElementById('toLang').value;
  const from = document.getElementById('fromLang').value;
  const templates = getNegoTemplates(currentRole, asking, target, walkaway);
  const container = document.getElementById('negoResults');
  const btn = document.querySelector('.nego-generate-btn');
  const t = window.hagglyI18n ? window.hagglyI18n.t : function(k, fb) { return fb || k; };
  trackEvent('generate_clicked', { context: 'negotiation_generator' });
  trackEvent('start_negotiation', { role: currentRole, from_lang: from, to_lang: tl });

  btn.disabled = true;
  btn.textContent = 'â³...';
  container.replaceChildren();

  try {
    const results = await Promise.all(templates.map(async (tmpl) => {
      let translated = tmpl.text;
      if (tl !== 'en') {
        try { translated = await translateText(tmpl.text, tl); } catch(e) { translated = tmpl.text; }
      }
      return { ...tmpl, translated };
    }));

    const fragment = document.createDocumentFragment();
    for (const r of results) {
      const toneLabel = t(r.label, r.labelFallback);
      const card = document.createElement('div');
      card.className = `nego-card ${r.css}`;

      const header = document.createElement('div');
      header.className = 'nego-card-header';
      header.textContent = `${r.emoji} ${toneLabel}`;

      const original = document.createElement('div');
      original.className = 'phrase-original';
      original.textContent = r.text;

      const translated = document.createElement('div');
      translated.className = 'nego-translated';
      translated.textContent = r.translated;

      const actions = document.createElement('div');
      actions.className = 'nego-card-actions';

      const copyBtn = document.createElement('button');
      copyBtn.className = 'nego-action-btn';
      copyBtn.type = 'button';
      copyBtn.dataset.copy = r.translated;
      copyBtn.dataset.context = 'negotiation_card';
      copyBtn.title = 'Copy';
      copyBtn.textContent = 'ğŸ“‹';

      const speakBtn = document.createElement('button');
      speakBtn.className = 'nego-action-btn';
      speakBtn.type = 'button';
      speakBtn.dataset.speak = r.translated;
      speakBtn.dataset.lang = tl;
      speakBtn.title = 'Listen';
      speakBtn.textContent = 'ğŸ”Š';

      const shareBtn = document.createElement('button');
      shareBtn.className = 'nego-action-btn';
      shareBtn.type = 'button';
      shareBtn.dataset.share = r.translated;
      shareBtn.dataset.shareContext = 'negotiation_card';
      shareBtn.title = window.hagglyI18n ? window.hagglyI18n.t('btn_share', 'Share') : 'Share';
      shareBtn.textContent = 'â†—';

      const smsBtn = document.createElement('button');
      smsBtn.className = 'nego-action-btn';
      smsBtn.type = 'button';
      smsBtn.dataset.sms = r.translated;
      smsBtn.dataset.shareContext = 'negotiation_card';
      smsBtn.textContent = 'SMS';

      const waBtn = document.createElement('button');
      waBtn.className = 'nego-action-btn';
      waBtn.type = 'button';
      waBtn.dataset.whatsapp = r.translated;
      waBtn.dataset.shareContext = 'negotiation_card';
      waBtn.textContent = 'WA';

      actions.appendChild(copyBtn);
      actions.appendChild(speakBtn);
      actions.appendChild(shareBtn);
      actions.appendChild(smsBtn);
      actions.appendChild(waBtn);
      card.appendChild(header);
      card.appendChild(original);
      card.appendChild(translated);
      card.appendChild(actions);
      fragment.appendChild(card);
    }
    container.appendChild(fragment);
    trackEvent('negotiation_generated', { role: currentRole, from_lang: from, to_lang: tl, phrase_count: results.length });
  } catch(e) {
    container.replaceChildren();
    const err = document.createElement('p');
    err.style.color = 'red';
    err.textContent = 'âŒ Error generating phrases. Try again.';
    container.appendChild(err);
    trackEvent('negotiation_generate_error', { role: currentRole, from_lang: from, to_lang: tl });
  } finally {
    btn.disabled = false;
    btn.textContent = t('nego_generate', 'Generate Phrases âœ¨');
  }
}

const swapBtn = document.querySelector('.swap-btn');
if (swapBtn) {
  swapBtn.addEventListener('click', swapLangs);
}

const fromLangSelect = document.getElementById('fromLang');
if (fromLangSelect) {
  fromLangSelect.addEventListener('change', handleFromLangChange);
}

const toLangSelect = document.getElementById('toLang');
if (toLangSelect) {
  toLangSelect.addEventListener('change', handleToLangChange);
}

document.addEventListener('haggly-lang-change', () => {
  trackEvent('language_changed', { context: 'ui_lang_picker' });
});

document.querySelectorAll('.role-btn[data-role]').forEach((btn) => {
  btn.addEventListener('click', () => setRole(btn.dataset.role));
});

const generateBtn = document.querySelector('.nego-generate-btn');
if (generateBtn) {
  generateBtn.addEventListener('click', generateNegoPhrases);
}

const translateBtn = document.querySelector('.translate-btn');
if (translateBtn) {
  translateBtn.addEventListener('click', translateCustom);
}

const negoInputIds = ['negoAskingPrice', 'negoTargetPrice', 'negoWalkawayPrice'];
negoInputIds.forEach((id) => {
  const input = document.getElementById(id);
  if (!input) return;
  input.addEventListener('input', () => {
    hasManualPriceInput = true;
  });
  input.addEventListener('keydown', (event) => {
    if (event.key !== 'Enter') return;
    event.preventDefault();
    generateNegoPhrases();
  });
});

const customPhraseInput = document.getElementById('customPhrase');
if (customPhraseInput) {
  customPhraseInput.addEventListener('keydown', (event) => {
    if (event.key !== 'Enter') return;
    if (!event.ctrlKey && !event.metaKey) return;
    event.preventDefault();
    translateCustom();
  });
}

document.addEventListener('click', (event) => {
  const smsTarget = event.target.closest('[data-sms]');
  if (smsTarget) {
    event.stopPropagation();
    openSMS(smsTarget.dataset.sms, { context: smsTarget.dataset.shareContext || 'unknown' });
    addRecentPhrase(smsTarget.dataset.sms, 'sms', { context: smsTarget.dataset.shareContext || 'unknown' });
    return;
  }

  const waTarget = event.target.closest('[data-whatsapp]');
  if (waTarget) {
    event.stopPropagation();
    openWhatsApp(waTarget.dataset.whatsapp, { context: waTarget.dataset.shareContext || 'unknown' });
    addRecentPhrase(waTarget.dataset.whatsapp, 'whatsapp', { context: waTarget.dataset.shareContext || 'unknown' });
    return;
  }

  const shareTarget = event.target.closest('[data-share]');
  if (shareTarget) {
    event.stopPropagation();
    const fromLang = document.getElementById('fromLang').value;
    const toLang = document.getElementById('toLang').value;
    shareText(
      shareTarget.dataset.share,
      shareTarget.dataset.shareContext || 'unknown',
      { role: currentRole, from_lang: fromLang, to_lang: toLang }
    );
    return;
  }

  const speakBtn = event.target.closest('[data-speak]');
  if (speakBtn) {
    event.stopPropagation();
    speakText(speakBtn.dataset.speak, speakBtn.dataset.lang);
    return;
  }

  const copyTarget = event.target.closest('[data-copy]');
  if (copyTarget) {
    copyText(copyTarget.dataset.copy, copyTarget.dataset.context || 'card_copy');
  }
});

document.addEventListener('keydown', (event) => {
  if (event.key !== 'Enter' && event.key !== ' ') return;

  const recentItem = event.target.closest('.recent-item[data-copy]');
  if (recentItem) {
    event.preventDefault();
    copyText(recentItem.dataset.copy, recentItem.dataset.context || 'recent_phrase_keyboard');
    return;
  }

  const copyTarget = event.target.closest('.custom-copy-target[data-copy]');
  if (!copyTarget) return;

  event.preventDefault();
  copyText(copyTarget.dataset.copy, 'custom_keyboard_copy');
});

// Register service worker for offline PWA
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js').catch(() => {});
}
</script>

<script src="ui-strings.js"></script>
<script src="localize.js"></script>
<script>
initializeLanguageSelectors();
renderRecentPhrases();
</script>

</body>
</html>
