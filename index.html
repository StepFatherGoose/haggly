<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=AW-17960372503"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'AW-17960372503');
</script>
<!-- Event snippet for Page view conversion page -->
<script>
  gtag('event', 'conversion', {'send_to': 'AW-17960372503/6MRdCOSz8PobEJeSlvRC'});
</script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Haggly â€” Negotiate in Any Language</title>
<meta name="description" content="Free marketplace negotiation translator. Bargain on Facebook Marketplace, Craigslist, and more in any language. Instant phrase translation for buyers and sellers.">
<meta property="og:title" content="Haggly â€” Negotiate in Any Language">
<meta property="og:description" content="Free marketplace negotiation translator. Bargain on Facebook Marketplace, Craigslist, and more in any language. 22 languages, instant copy-paste phrases.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://haggly.io/">
<meta property="og:image" content="https://haggly.io/icon-512.svg">
<meta property="og:site_name" content="Haggly">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Haggly â€” Negotiate in Any Language">
<meta name="twitter:description" content="Free marketplace negotiation translator. 22 languages, instant copy-paste.">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#E0622E">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6632867015737384" crossorigin="anonymous"></script>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¤</text></svg>">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --primary: #E0622E;
    --primary-dark: #C4531F;
    --bg: #FAFAFA;
    --card: #FFFFFF;
    --text: #1a1a1a;
    --muted: #666;
    --border: #e0e0e0;
    --green: #00C853;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    min-height: 100vh;
  }

  /* Header */
  .header {
    background: var(--primary);
    color: white;
    text-align: center;
    padding: 40px 20px 30px;
  }
  .header h1 {
    font-size: 42px;
    font-weight: 800;
    letter-spacing: -1px;
  }
  .header p {
    font-size: 20px;
    opacity: 0.9;
    margin-top: 8px;
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
  }

  /* Main Container */
  .container {
    max-width: 700px;
    margin: 0 auto;
    padding: 20px;
  }

  /* Language Selector */
  .lang-section {
    background: var(--card);
    border-radius: 16px;
    padding: 24px;
    margin: 20px 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  }
  .lang-row {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
  }
  .lang-label {
    font-size: 14px;
    font-weight: 600;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    min-width: 80px;
  }
  select {
    flex: 1;
    padding: 14px 16px;
    font-size: 18px;
    border: 2px solid var(--border);
    border-radius: 12px;
    background: white;
    color: var(--text);
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 16px center;
  }
  select:focus { border-color: var(--primary); outline: none; }

  .swap-btn {
    background: var(--primary);
    color: white;
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    transition: transform 0.2s;
  }
  .swap-btn:hover { transform: rotate(180deg); }

  /* Role Selector */
  .role-row {
    display: flex;
    gap: 10px;
    margin: 20px 0;
  }
  .role-btn {
    flex: 1;
    padding: 14px;
    font-size: 18px;
    font-weight: 600;
    border: 2px solid var(--border);
    border-radius: 12px;
    background: white;
    cursor: pointer;
    text-align: center;
    transition: all 0.2s;
  }
  .role-btn.active {
    border-color: var(--primary);
    background: #EEF0FE;
    color: var(--primary);
  }
  .role-btn:hover { border-color: var(--primary); }

  /* Phrases */
  .category-title {
    font-size: 16px;
    font-weight: 700;
    color: var(--primary);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin: 24px 0 12px;
    padding-bottom: 8px;
    border-bottom: 2px solid #EEF0FE;
  }

  .phrase-card {
    background: var(--card);
    border-radius: 12px;
    padding: 16px 20px;
    margin: 8px 0;
    box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    cursor: pointer;
    transition: all 0.15s;
    border-left: 4px solid transparent;
  }
  .phrase-card:hover {
    border-left-color: var(--primary);
    transform: translateX(4px);
  }
  .phrase-card:active { background: #EEF0FE; }

  .phrase-original {
    font-size: 15px;
    color: var(--muted);
    margin-bottom: 4px;
  }
  .phrase-translated {
    font-size: 20px;
    font-weight: 600;
    color: var(--text);
    display: inline;
  }
  .phrase-phonetic {
    font-size: 14px;
    color: var(--primary);
    font-style: italic;
    margin-top: 2px;
  }

  .copied-toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: #333;
    color: white;
    padding: 12px 24px;
    border-radius: 30px;
    font-size: 16px;
    font-weight: 600;
    transition: transform 0.3s ease;
    z-index: 100;
  }
  .copied-toast.show { transform: translateX(-50%) translateY(0); }

  /* Custom phrase input */
  .custom-input {
    background: var(--card);
    border-radius: 16px;
    padding: 20px;
    margin: 20px 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  }
  .custom-input textarea {
    width: 100%;
    padding: 14px;
    font-size: 18px;
    border: 2px solid var(--border);
    border-radius: 12px;
    resize: vertical;
    min-height: 60px;
    font-family: inherit;
  }
  .custom-input textarea:focus { border-color: var(--primary); outline: none; }
  .translate-btn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 14px 28px;
    font-size: 18px;
    font-weight: 600;
    border-radius: 12px;
    cursor: pointer;
    margin-top: 12px;
    width: 100%;
    transition: background 0.2s;
  }
  .translate-btn:hover { background: var(--primary-dark); }
  .custom-result {
    margin-top: 16px;
    padding: 16px;
    background: #EEF0FE;
    border-radius: 12px;
    font-size: 20px;
    font-weight: 600;
    display: none;
    cursor: pointer;
  }

  /* Nav */
  nav { background: var(--primary); padding: 14px 20px; display: flex; align-items: center; flex-wrap: wrap; gap: 8px; }
  nav a { color: white; text-decoration: none; font-weight: 600; font-size: 15px; padding: 6px 12px; border-radius: 8px; transition: background 0.2s; }
  nav a:hover { background: rgba(255,255,255,0.2); }
  nav .brand { font-size: 20px; font-weight: 800; margin-right: 0; }

  /* Footer */
  .footer {
    text-align: center;
    padding: 30px 20px;
    color: var(--muted);
    font-size: 14px;
    border-top: 1px solid var(--border);
    margin-top: 20px;
  }
  .footer a { color: var(--primary); text-decoration: none; }
  .footer-links { margin-bottom: 12px; }
  .footer-links a { margin: 0 10px; }

  /* Guide CTA */
  .guide-cta {
    background: var(--card);
    border-radius: 16px;
    padding: 24px;
    margin: 20px 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    text-align: center;
  }
  .guide-cta a {
    color: var(--primary);
    font-weight: 700;
    font-size: 18px;
    text-decoration: none;
  }
  .guide-cta a:hover { text-decoration: underline; }
  .guide-cta p { color: var(--muted); font-size: 15px; margin-top: 6px; }

  /* TTS button */
  .tts-btn {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 18px;
    padding: 2px 6px;
    margin-left: 6px;
    border-radius: 6px;
    vertical-align: middle;
    opacity: 0.6;
    transition: opacity 0.2s;
  }
  .tts-btn:hover { opacity: 1; background: #EEF0FE; }

  /* Negotiation Generator */
  .nego-section {
    background: var(--card);
    border-radius: 16px;
    padding: 24px;
    margin: 20px 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  }
  .nego-section h2 {
    font-size: 20px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 16px;
    text-align: center;
  }
  .nego-inputs {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 16px;
  }
  .nego-field label {
    display: block;
    font-size: 13px;
    font-weight: 600;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
  }
  .nego-field input {
    width: 100%;
    padding: 12px 14px;
    font-size: 18px;
    border: 2px solid var(--border);
    border-radius: 12px;
    background: white;
    color: var(--text);
    font-family: inherit;
  }
  .nego-field input:focus { border-color: var(--primary); outline: none; }
  .nego-generate-btn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 14px 28px;
    font-size: 18px;
    font-weight: 600;
    border-radius: 12px;
    cursor: pointer;
    width: 100%;
    transition: background 0.2s;
  }
  .nego-generate-btn:hover { background: var(--primary-dark); }
  .nego-generate-btn:disabled { opacity: 0.6; cursor: not-allowed; }
  .nego-results {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 16px;
  }
  .nego-card {
    background: #F8F8FF;
    border-radius: 12px;
    padding: 16px 20px;
    border-left: 4px solid var(--primary);
  }
  .nego-card.friendly { border-left-color: #00C853; }
  .nego-card.savvy { border-left-color: #FF9800; }
  .nego-card.walkaway { border-left-color: #F44336; }
  .nego-card-header {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 8px;
  }
  .nego-card .phrase-original {
    font-size: 13px;
    color: var(--muted);
    margin-bottom: 4px;
  }
  .nego-card .nego-translated {
    font-size: 18px;
    font-weight: 600;
    color: var(--text);
    display: inline;
  }
  .nego-card-actions {
    margin-top: 8px;
    display: flex;
    gap: 8px;
  }
  .nego-action-btn {
    background: none;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 4px 10px;
    font-size: 15px;
    cursor: pointer;
    transition: background 0.2s;
  }
  .nego-action-btn:hover { background: #EEF0FE; }

  @media (max-width: 600px) {
    nav { justify-content: center; }
    nav .brand { width: 100%; text-align: center; }
  }
</style>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "Haggly",
  "url": "https://haggly.io",
  "description": "Free marketplace negotiation translator. Bargain on Facebook Marketplace, Craigslist, and more in 22 languages.",
  "applicationCategory": "UtilityApplication",
  "operatingSystem": "All",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "inLanguage": ["en","es","zh","ar","hi","pt","fr","de","ja","ko","vi","tl","ru","pl","uk","sw","ha","am","ht","th","tr","id"]
}
</script>
<link rel="canonical" href="https://haggly.io/">
</head>
<body>

<nav>
  <a href="/" class="brand">ğŸ¤ Haggly</a>
  <a href="/" data-i18n="nav_home">Home</a>
  <a href="/guide.html" data-i18n="nav_guide">City Guides</a>
  <a href="/about.html" data-i18n="nav_about">About</a>
  <a href="/privacy.html" data-i18n="nav_privacy">Privacy</a>
  <a href="/terms.html" data-i18n="nav_terms">Terms</a>
  <a href="/contact.html" data-i18n="nav_contact">Contact</a>
</nav>

<div class="header">
  <h1>ğŸ¤ Haggly</h1>
  <p data-i18n="header_tagline">Negotiate in any language. Tap a phrase, copy it, close the deal.</p>
</div>

<div class="container">

  <!-- Language Selection -->
  <div class="lang-section">
    <div class="lang-row">
      <span class="lang-label" data-i18n="label_i_speak">I speak</span>
      <select id="fromLang">
        <option value="en">ğŸ‡ºğŸ‡¸ English</option>
        <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
        <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
        <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
        <option value="hi">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
        <option value="pt">ğŸ‡§ğŸ‡· PortuguÃªs</option>
        <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
        <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
        <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
        <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
        <option value="vi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</option>
        <option value="tl">ğŸ‡µğŸ‡­ Tagalog</option>
        <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
        <option value="pl">ğŸ‡µğŸ‡± Polski</option>
        <option value="uk">ğŸ‡ºğŸ‡¦ Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°</option>
        <option value="sw">ğŸ‡°ğŸ‡ª Kiswahili</option>
        <option value="ha">ğŸ‡³ğŸ‡¬ Hausa</option>
        <option value="am">ğŸ‡ªğŸ‡¹ áŠ áˆ›áˆ­áŠ›</option>
        <option value="ht">ğŸ‡­ğŸ‡¹ KreyÃ²l Ayisyen</option>
        <option value="th">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</option>
        <option value="tr">ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</option>
        <option value="id">ğŸ‡®ğŸ‡© Bahasa Indonesia</option>
      </select>
    </div>

    <button class="swap-btn" onclick="swapLangs()" data-i18n-title="swap_title" title="Swap languages">â‡…</button>

    <div class="lang-row" style="margin-top:12px">
      <span class="lang-label" data-i18n="label_they_speak">They speak</span>
      <select id="toLang">
        <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
        <option value="en">ğŸ‡ºğŸ‡¸ English</option>
        <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
        <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
        <option value="hi">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
        <option value="pt">ğŸ‡§ğŸ‡· PortuguÃªs</option>
        <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
        <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
        <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
        <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
        <option value="vi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</option>
        <option value="tl">ğŸ‡µğŸ‡­ Tagalog</option>
        <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
        <option value="pl">ğŸ‡µğŸ‡± Polski</option>
        <option value="uk">ğŸ‡ºğŸ‡¦ Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°</option>
        <option value="sw">ğŸ‡°ğŸ‡ª Kiswahili</option>
        <option value="ha">ğŸ‡³ğŸ‡¬ Hausa</option>
        <option value="am">ğŸ‡ªğŸ‡¹ áŠ áˆ›áˆ­áŠ›</option>
        <option value="ht">ğŸ‡­ğŸ‡¹ KreyÃ²l Ayisyen</option>
        <option value="th">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</option>
        <option value="tr">ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</option>
        <option value="id">ğŸ‡®ğŸ‡© Bahasa Indonesia</option>
      </select>
    </div>
  </div>

  <!-- Role -->
  <div class="role-row">
    <button class="role-btn active" data-role="buyer" onclick="setRole('buyer')" data-i18n="btn_buying">ğŸ›’ I'm Buying</button>
    <button class="role-btn" data-role="seller" onclick="setRole('seller')" data-i18n="btn_selling">ğŸ’° I'm Selling</button>
  </div>

  <!-- Negotiation Generator -->
  <div class="nego-section">
    <h2 data-i18n="negotiation_tool">ğŸ’¬ Negotiation Generator</h2>
    <div class="nego-inputs">
      <div class="nego-field">
        <label data-i18n="nego_asking_price">Asking Price</label>
        <input type="number" id="negoAskingPrice" placeholder="100" min="0" step="any">
      </div>
      <div class="nego-field">
        <label data-i18n="nego_target_price">Your Target Price</label>
        <input type="number" id="negoTargetPrice" placeholder="75" min="0" step="any">
      </div>
      <div class="nego-field">
        <label data-i18n="nego_walkaway_price">Your Walk-Away Price</label>
        <input type="number" id="negoWalkawayPrice" placeholder="85" min="0" step="any">
      </div>
    </div>
    <button class="nego-generate-btn" onclick="generateNegoPhrases()" data-i18n="nego_generate">Generate Phrases âœ¨</button>
    <div class="nego-results" id="negoResults"></div>
  </div>

  <!-- Phrases -->
  <div id="phrases"></div>

  <!-- Ad Slot: After Phrases -->
  <div style="text-align:center; margin: 24px 0; min-height: 90px;">
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6632867015737384" data-ad-slot="auto" data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
  </div>

  <!-- Custom Phrase -->
  <div class="custom-input">
    <textarea id="customPhrase" data-i18n="custom_placeholder" placeholder="Type your own phrase to translate..."></textarea>
    <button class="translate-btn" onclick="translateCustom()" data-i18n="btn_translate">Translate â†’</button>
    <div class="custom-result" id="customResult" onclick="copyText(this.textContent)"></div>
  </div>

  <!-- Ad Slot: Before Guide CTA -->
  <div style="text-align:center; margin: 24px 0; min-height: 90px;">
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6632867015737384" data-ad-slot="auto" data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
  </div>

  <!-- Guide CTA -->
  <div class="guide-cta">
    <a href="/guide.html" data-i18n="guide_cta">ğŸ“– How to Negotiate on Facebook Marketplace â†’</a>
    <p data-i18n="guide_cta_sub">Tips, etiquette, safety advice, and how to handle language barriers</p>
  </div>

  <div class="footer">
    <div class="footer-links">
      <a href="/about.html" data-i18n="footer_about">About</a>
      <a href="/privacy.html" data-i18n="footer_privacy">Privacy Policy</a>
      <a href="/terms.html" data-i18n="footer_terms">Terms of Service</a>
      <a href="/contact.html" data-i18n="footer_contact">Contact</a>
    </div>
    <p data-i18n="footer_copyright">Â© 2026 Haggly. Built with â¤ï¸ for the global marketplace.</p>
  </div>
</div>

<div class="copied-toast" id="toast" data-i18n="toast_copied">âœ… Copied! Paste it in your chat</div>

<script>
// Phrase database â€” all translations
const PHRASES = {
  buyer: {
    "Opening & Greeting": [
      "Hi, is this still available?",
      "I'm interested in this item.",
      "Can you tell me more about the condition?",
      "How old is this?",
      "Does it work properly?",
      "Are there any scratches or damage?"
    ],
    "Negotiating Price": [
      "What's your best price?",
      "Would you take $__?",
      "That's a bit high for me. Can you do lower?",
      "I've seen similar items for less.",
      "I can pay cash right now.",
      "If I buy two, can you give me a deal?",
      "Can you meet me in the middle?",
      "Is the price firm or negotiable?"
    ],
    "Logistics": [
      "Can you deliver it?",
      "Where can we meet?",
      "Can I pick it up today?",
      "What time works for you?",
      "Can I see it first before buying?",
      "I'll meet you at a public place.",
      "Can you hold it for me until tomorrow?"
    ],
    "Closing the Deal": [
      "Deal! I'll take it.",
      "I'll send you my location.",
      "Cash or digital payment?",
      "Do you accept Zelle / Venmo / Cash App?",
      "Thank you! Great doing business with you.",
      "I changed my mind, sorry."
    ]
  },
  seller: {
    "Listing & Greeting": [
      "Yes, it's still available!",
      "Thanks for your interest.",
      "It's in great condition.",
      "It's like new, barely used.",
      "Here are more photos.",
      "I bought it __ months ago."
    ],
    "Negotiating Price": [
      "My asking price is $__.",
      "The price is firm.",
      "I can do $__ if you pick up today.",
      "Sorry, that's too low.",
      "I already have other buyers interested.",
      "I'll give you a small discount for cash.",
      "Best I can do is $__.",
      "The price already includes __."
    ],
    "Logistics": [
      "You can pick it up at __.",
      "I can meet at a public location.",
      "I'm available today after __.",
      "Let me know when you're on the way.",
      "Please be on time.",
      "I can hold it until __ for you.",
      "No delivery, pickup only."
    ],
    "Closing the Deal": [
      "Great, it's yours!",
      "I accept cash, Zelle, or Venmo.",
      "No refunds or returns.",
      "Thanks for buying! Enjoy it.",
      "I'll mark it as sold.",
      "Sorry, it's already been sold."
    ]
  }
};

// Category name â†’ i18n key mapping
const CATEGORY_I18N = {
  "Opening & Greeting": "cat_opening",
  "Negotiating Price": "cat_negotiating",
  "Logistics": "cat_logistics",
  "Closing the Deal": "cat_closing",
  "Listing & Greeting": "cat_listing"
};

let currentRole = 'buyer';

function setRole(role) {
  currentRole = role;
  document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
  document.querySelector(`[data-role="${role}"]`).classList.add('active');
  renderPhrases();
}

function swapLangs() {
  const from = document.getElementById('fromLang');
  const to = document.getElementById('toLang');
  const tmp = from.value;
  from.value = to.value;
  to.value = tmp;
  renderPhrases();
}

function getTranslation(phrase) {
  const from = document.getElementById('fromLang').value;
  const to = document.getElementById('toLang').value;

  if (from === to) return phrase;

  // Use TRANSLATIONS from translations.js
  if (typeof TRANSLATIONS !== 'undefined' && TRANSLATIONS[from] && TRANSLATIONS[from][to] && TRANSLATIONS[from][to][phrase]) {
    return TRANSLATIONS[from][to][phrase];
  }

  return phrase;
}

function escapeHtml(str) {
  return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}

function renderPhrases() {
  const container = document.getElementById('phrases');
  const phrases = PHRASES[currentRole];
  const toLang = document.getElementById('toLang').value;
  const t = window.hagglyI18n ? window.hagglyI18n.t : function(k) { return k; };
  let html = '';

  for (const [category, items] of Object.entries(phrases)) {
    const i18nKey = CATEGORY_I18N[category] || category;
    const localizedCat = t(i18nKey);
    html += `<div class="category-title" data-i18n="${i18nKey}">${escapeHtml(localizedCat)}</div>`;
    for (const phrase of items) {
      const translated = getTranslation(phrase);
      const escapedTranslated = escapeHtml(translated);
      html += `
        <div class="phrase-card" onclick="copyText('${translated.replace(/\\/g,'\\\\').replace(/'/g,"\\'")}')">
          <div class="phrase-original">${escapeHtml(phrase)}</div>
          <div class="phrase-translated-row">
            <span class="phrase-translated">${escapedTranslated}</span>
            <button class="tts-btn" onclick="event.stopPropagation(); speakText('${translated.replace(/\\/g,'\\\\').replace(/'/g,"\\'")}', '${toLang}')" title="Listen">ğŸ”Š</button>
          </div>
        </div>`;
    }
  }

  container.innerHTML = html;
}

function copyText(text) {
  navigator.clipboard.writeText(text).then(() => {
    const toast = document.getElementById('toast');
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 2000);
  });
}

async function translateCustom() {
  const text = document.getElementById('customPhrase').value.trim();
  if (!text) return;
  const result = document.getElementById('customResult');
  const sl = document.getElementById('fromLang').value;
  const tl = document.getElementById('toLang').value;
  result.style.display = 'block';
  result.innerHTML = 'â³ Translating...';
  try {
    const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${encodeURIComponent(sl)}&tl=${encodeURIComponent(tl)}&dt=t&q=${encodeURIComponent(text)}`;
    const res = await fetch(url);
    if (!res.ok) throw new Error('Translation failed');
    const data = await res.json();
    const translated = data[0].map(s => s[0]).join('');
    result.innerHTML = `<span class="phrase-translated" style="cursor:pointer" onclick="copyText('${translated.replace(/\\/g,'\\\\').replace(/'/g,"\\'")}')">${escapeHtml(translated)}</span>` +
      `<button class="tts-btn" onclick="event.stopPropagation(); speakText('${translated.replace(/\\/g,'\\\\').replace(/'/g,"\\'")}', '${tl}')" title="Listen">ğŸ”Š</button>`;
  } catch (e) {
    result.innerHTML = 'âŒ Translation error. Please try again.';
  }
}

function speakText(text, lang) {
  if ('speechSynthesis' in window) {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = lang;
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
  }
}

// Listen for language changes
document.getElementById('fromLang').addEventListener('change', renderPhrases);
document.getElementById('toLang').addEventListener('change', renderPhrases);

// Re-render when UI language changes (for category headers)
document.addEventListener('haggly-lang-change', renderPhrases);

// Initial render
renderPhrases();

// Negotiation Generator
function getNegoTemplates(role, asking, target, walkaway) {
  if (role === 'buyer') {
    return [
      { tone: 'friendly', emoji: 'ğŸ¤', label: 'nego_tone_friendly', labelFallback: 'Friendly', css: 'friendly',
        text: `That's a nice item. Would you consider ${target}? I really like it and I'm ready to buy today.` },
      { tone: 'savvy', emoji: 'ğŸ˜', label: 'nego_tone_savvy', labelFallback: 'Savvy', css: 'savvy',
        text: `I know the fair price is around ${target}. I'll pay that right now, cash in hand.` },
      { tone: 'walkaway', emoji: 'ğŸš¶', label: 'nego_tone_walkaway', labelFallback: 'Walk-Away', css: 'walkaway',
        text: `Thank you, but ${asking} is too much for me. I can only do ${walkaway}. If not, no problem. Good luck with the sale.` }
    ];
  } else {
    return [
      { tone: 'friendly', emoji: 'ğŸ¤', label: 'nego_tone_friendly', labelFallback: 'Friendly', css: 'friendly',
        text: `Thanks for your interest! I'm asking ${asking}, but I could do ${target} if you can pick it up today.` },
      { tone: 'savvy', emoji: 'ğŸ˜', label: 'nego_tone_savvy', labelFallback: 'Savvy', css: 'savvy',
        text: `This is a great deal at ${asking}. I already have other people interested, but I can do ${target} if you come today.` },
      { tone: 'walkaway', emoji: 'ğŸš¶', label: 'nego_tone_walkaway', labelFallback: 'Walk-Away', css: 'walkaway',
        text: `The lowest I can go is ${walkaway}. That's firm. If that doesn't work for you, no worries.` }
    ];
  }
}

async function translateText(text, tl) {
  const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=${encodeURIComponent(tl)}&dt=t&q=${encodeURIComponent(text)}`;
  const res = await fetch(url);
  if (!res.ok) throw new Error('Translation failed');
  const data = await res.json();
  return data[0].map(s => s[0]).join('');
}

async function generateNegoPhrases() {
  const asking = document.getElementById('negoAskingPrice').value.trim();
  const target = document.getElementById('negoTargetPrice').value.trim();
  const walkaway = document.getElementById('negoWalkawayPrice').value.trim();
  if (!asking || !target || !walkaway) { alert('Please fill in all three prices.'); return; }

  const tl = document.getElementById('toLang').value;
  const templates = getNegoTemplates(currentRole, asking, target, walkaway);
  const container = document.getElementById('negoResults');
  const btn = document.querySelector('.nego-generate-btn');
  const t = window.hagglyI18n ? window.hagglyI18n.t : function(k, fb) { return fb || k; };

  btn.disabled = true;
  btn.textContent = 'â³...';
  container.innerHTML = '';

  try {
    const results = await Promise.all(templates.map(async (tmpl) => {
      let translated = tmpl.text;
      if (tl !== 'en') {
        try { translated = await translateText(tmpl.text, tl); } catch(e) { translated = tmpl.text; }
      }
      return { ...tmpl, translated };
    }));

    let html = '';
    for (const r of results) {
      const toneLabel = t(r.label, r.labelFallback);
      const safeTranslated = escapeHtml(r.translated);
      const safeOriginal = escapeHtml(r.text);
      const jsTranslated = r.translated.replace(/\\/g,'\\\\').replace(/'/g,"\\'");
      html += `
        <div class="nego-card ${r.css}">
          <div class="nego-card-header">${r.emoji} ${escapeHtml(toneLabel)}</div>
          <div class="phrase-original">${safeOriginal}</div>
          <div class="nego-translated">${safeTranslated}</div>
          <div class="nego-card-actions">
            <button class="nego-action-btn" onclick="copyText('${jsTranslated}')" title="Copy">ğŸ“‹</button>
            <button class="nego-action-btn" onclick="speakText('${jsTranslated}', '${tl}')" title="Listen">ğŸ”Š</button>
          </div>
        </div>`;
    }
    container.innerHTML = html;
  } catch(e) {
    container.innerHTML = '<p style="color:red">âŒ Error generating phrases. Try again.</p>';
  } finally {
    btn.disabled = false;
    btn.textContent = t('nego_generate', 'Generate Phrases âœ¨');
  }
}

// Register service worker for offline PWA
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js').catch(() => {});
}
</script>

<script src="translations.js"></script>
<script src="ui-strings.js"></script>
<script src="localize.js"></script>

</body>
</html>
